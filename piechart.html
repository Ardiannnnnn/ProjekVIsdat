<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Total Test by Country - Pie Chart</title>
    <style>
        /* Add any desired styles for the chart container */
        #chart-container {
            width: 400px;
            height: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div id="chart-container"></div>

    <script src="https://d3js.org/d3.v6.min.js"></script>

    <script>
        // Define the data for the pie chart
        const data = [
            { country: "Germany", totalTests: 122332384 },
            { country: "Uruguay", totalTests: 6114822 },
            { country: "Costa Rica", totalTests: 4659757 },
            { country: "North Macedonia", totalTests: 2216193 },
            { country: "Bermuda", totalTests: 1024947 },
            { country: "Guinea", totalTests: 790354 },
            { country: "Sint Maarten", totalTests: 660107 },
            { country: "Cook Islands", totalTests: 62056 },
        ];

        // Define the dimensions and radius of the pie chart
        const width = 400;
        const height = 400;
        const radius = Math.min(width, height) / 2;

        // Create the SVG element
        const svg = d3.select("#chart-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", `translate(${width / 2}, ${height / 2})`);

        // Define the color scale for the pie slices
        const colorScale = d3.scaleOrdinal()
            .domain(data.map(d => d.country))
            .range(d3.schemeCategory10);

        // Define the pie layout
        const pie = d3.pie()
            .value(d => d.totalTests);

        // Generate the pie slices
        const arcs = pie(data);

        // Create the pie slices
        svg.selectAll("path")
            .data(arcs)
            .enter().append("path")
            .attr("d", d3.arc()
                .innerRadius(0)
                .outerRadius(radius)
            )
            .attr("fill", d => colorScale(d.data.country))
            .attr("stroke", "white")
            .style("stroke-width", "2px");

        // Add labels to the pie slices
        const labels = svg.selectAll("text")
            .data(arcs)
            .enter().append("text")
            .attr("transform", d => `translate(${d3.arc().innerRadius(0).outerRadius(radius * 0.8).centroid(d)})`)
            .attr("text-anchor", "middle")
            .text(d => `${d.data.country} (${((d.data.totalTests / d3.sum(data, d => d.totalTests)) * 100).toFixed(2)}%)`)
            .style("font-size", "12px");

        // Add a title
        svg.append("text")
            .attr("x", 0)
            .attr("y", -height / 2 + 20)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text("Total Test by Country");

    </script>
</body>
</html>
